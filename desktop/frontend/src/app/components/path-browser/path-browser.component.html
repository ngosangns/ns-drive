<div class="relative" (clickOutside)="closeDropdown()">
  <div class="flex items-center gap-1">
    <input
      pInputText
      [value]="path"
      (input)="onInputChange($event)"
      [placeholder]="placeholder"
      class="flex-1"
    />
    <p-button
      icon="pi pi-folder-open"
      [text]="true"
      [rounded]="true"
      size="small"
      (onClick)="toggleDropdown()"
      [loading]="isLoading"
    />
  </div>

  @if (showDropdown) {
  <div class="absolute z-50 w-full mt-1 bg-gray-800 border border-gray-700 rounded-lg shadow-lg max-h-48 overflow-auto">
    @if (isLoading) {
    <div class="flex items-center justify-center p-3">
      <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-primary-400 mr-2"></div>
      <span class="text-xs text-gray-400">Loading...</span>
    </div>
    } @else if (errorMessage) {
    <div class="p-3 text-xs text-red-400 text-center">
      <i class="pi pi-exclamation-triangle mr-1"></i>{{ errorMessage }}
    </div>
    } @else {
      <!-- Current browsing path -->
      @if (browsingPath) {
      <div class="px-3 py-1.5 text-xs text-gray-500 border-b border-gray-700 truncate">
        {{ browsingPath }}
      </div>
      }

      <!-- Go up entry -->
      @if (browsingPath) {
      <div
        class="flex items-center gap-2 px-3 py-2 cursor-pointer hover:bg-gray-700 text-gray-300 text-sm"
        (click)="goUp()"
      >
        <i class="pi pi-arrow-up text-gray-500"></i>
        <span>..</span>
      </div>
      }

      <!-- File/folder entries -->
      @for (entry of filteredEntries; track entry.name) {
      <div
        class="flex items-center gap-2 px-3 py-2 cursor-pointer hover:bg-gray-700 text-sm"
        (click)="selectEntry(entry)"
      >
        <i [class]="entry.is_dir ? 'pi pi-folder text-yellow-400' : 'pi pi-file text-gray-400'"></i>
        <span class="truncate" [class]="entry.is_dir ? 'text-gray-200' : 'text-gray-400'">{{ entry.name }}</span>
      </div>
      }

      @if (filteredEntries.length === 0) {
      <div class="p-3 text-xs text-gray-500 text-center">Empty directory</div>
      }
    }
  </div>
  }
</div>
